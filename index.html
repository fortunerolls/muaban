<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Muaban.vin — Web3 Commerce (VND ⇄ VIN)</title>
  <meta name="description" content="Muaban.vin là nền tảng thương mại điện tử Web3 on-chain, thanh toán VIN, giá theo VND." />

  <!-- Favicon / Logo -->
  <link rel="icon" href="logo.png" />
  <meta property="og:title" content="Muaban.vin — Web3 Commerce" />
  <meta property="og:image" content="logo.png" />

  <!-- App config để app.js đọc -->
  <script>
    window.MB_CONFIG = {
      // Chain
      VIC: {
        CHAIN_ID_DEC: 88,
        CHAIN_ID_HEX: "0x58",
        RPC_URLS: ["https://rpc.viction.xyz"],
        CHAIN_NAME: "Viction Mainnet",
        NATIVE_CURRENCY: { name: "VIC", symbol: "VIC", decimals: 18 },
        EXPLORER: "https://vicscan.xyz"
      },
      // Contracts (theo mô tả)
      MUABAN_ADDRESS: "0x190FD18820498872354eED9C4C080cB365Cd12E0",  // Muaban (VIC)
      VIN_TOKEN:      "0x941F63807401efCE8afe3C9d88d368bAA287Fac4",  // VIN (VIC)
      // Pricing sources
      BINANCE_VIC_USDT: "https://api.binance.com/api/v3/ticker/price?symbol=VICUSDT",
      COINGECKO_USDT_VND: "https://api.coingecko.com/api/v3/simple/price?ids=tether&vs_currencies=vnd",
      // UI
      PAGE_SIZE: 20
    };
  </script>

  <!-- Styles -->
  <link rel="stylesheet" href="style.css" />
  <!-- ethers v6 (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <!-- Header / Topbar -->
  <header class="topbar">
    <div class="topbar-left">
      <img src="logo.png" alt="Muaban.vin" class="logo" />
      <div class="brand">
        <h1 class="title">Muaban.vin</h1>
        <p class="slogan">Web3 Commerce • VND pricing • VIN escrow</p>
      </div>
    </div>

    <div class="topbar-center">
      <div id="vin-vnd" class="price-chip">1 VIN = <span id="vin-vnd-value">—</span> VND</div>
    </div>

    <div class="topbar-right">
      <button id="btnConnect" class="btn primary">Kết nối ví</button>
      <div id="walletInfo" class="wallet hidden">
        <div class="balances">
          <span>VIN: <b id="balVIN">—</b></span>
          <span>VIC: <b id="balVIC">—</b></span>
        </div>
        <a id="addrShort" href="#" target="_blank" rel="noopener" class="addr">0x…</a>
      </div>
    </div>
  </header>

  <!-- Subnav: actions -->
  <nav class="subnav">
    <div class="left">
      <button id="navHome" class="tab active">Trang chủ</button>
      <button id="navCreate" class="tab">Đăng sản phẩm</button>
      <button id="navBuyer" class="tab">Đơn hàng mua</button>
      <button id="navSeller" class="tab">Đơn hàng bán</button>
    </div>
    <div class="right">
      <button id="btnRegister" class="btn outline">Đăng ký (0.001 VIN)</button>
    </div>
  </nav>

  <!-- Search -->
  <section class="searchbar">
    <input id="searchInput" type="text" placeholder="Tìm sản phẩm..." />
    <button id="btnSearch" class="btn">Tìm</button>
  </section>

  <!-- MAIN SCREENS -->
  <main>
    <!-- LISTING -->
    <section id="screenHome" class="screen">
      <div id="productsList" class="grid"></div>
      <div id="homeEmpty" class="empty hidden">Chưa có sản phẩm.</div>
      <div id="homeLoading" class="loading">Đang tải sản phẩm…</div>
    </section>

    <!-- CREATE PRODUCT -->
    <section id="screenCreate" class="screen hidden">
      <div class="card">
        <h2>Đăng sản phẩm</h2>
        <div class="form">
          <label>Tên sản phẩm (≤ 500 ký tự)</label>
          <input id="createName" type="text" maxlength="500" placeholder="VD: Tai nghe Bluetooth XYZ" />

          <label>Hình ảnh/video (IPFS link)</label>
          <input id="createIPFS" type="url" placeholder="https://ipfs.io/ipfs/..." />

          <label>Đơn vị tính</label>
          <input id="createUnit" type="text" placeholder="cái / chiếc / hộp ..." />

          <label>Giá bán (VND)</label>
          <input id="createPrice" type="number" min="1" step="1" placeholder="VD: 350000" />

          <label>Ví nhận thanh toán (VIN)</label>
          <input id="createWallet" type="text" placeholder="0x..." />

          <label>Thời gian giao hàng tối đa (ngày)</label>
          <input id="createDays" type="number" min="1" step="1" placeholder="VD: 3" />

          <div class="row">
            <label class="checkbox">
              <input id="createActive" type="checkbox" checked />
              <span>Đang bán (active)</span>
            </label>
          </div>

          <button id="btnCreate" class="btn primary">Đăng</button>
        </div>

        <div class="hint">
          * Mô tả chi tiết sản phẩm để ở <b>descriptionCID</b> (app.js sẽ mã hóa/định dạng từ “unit:…” theo mô tả).  
          * Bạn cần đã <b>Đăng ký</b> (0.001 VIN) trước khi đăng sản phẩm. :contentReference[oaicite:2]{index=2}
        </div>
      </div>
    </section>

    <!-- BUYER ORDERS -->
    <section id="screenBuyer" class="screen hidden">
      <div class="card">
        <h2>Đơn hàng mua của tôi</h2>
        <div id="buyerOrders" class="list"></div>
        <div id="buyerEmpty" class="empty hidden">Chưa có đơn hàng.</div>
      </div>
    </section>

    <!-- SELLER ORDERS / PRODUCTS -->
    <section id="screenSeller" class="screen hidden">
      <div class="card">
        <h2>Sản phẩm của tôi</h2>
        <div id="sellerProducts" class="list"></div>
        <div id="sellerEmpty" class="empty hidden">Chưa có sản phẩm nào bạn đăng.</div>
      </div>

      <div class="card">
        <h2>Đơn hàng mới của sản phẩm tôi bán</h2>
        <div id="sellerOrders" class="list"></div>
        <div id="sellerOrdersEmpty" class="empty hidden">Chưa có đơn hàng.</div>
      </div>
    </section>
  </main>

  <!-- MODALS -->
  <!-- Product detail / Buy modal -->
  <div id="modalBuy" class="modal hidden">
    <div class="modal-card">
      <div class="modal-head">
        <h3 id="buyTitle">Mua sản phẩm</h3>
        <button class="icon close" id="buyClose">×</button>
      </div>
      <div class="modal-body">
        <div class="buy-product">
          <img id="buyImg" alt="" />
          <div class="meta">
            <div class="name" id="buyName">—</div>
            <div class="price">Giá: <b id="buyPriceVND">—</b> VND / <span id="buyUnit">đơn vị</span></div>
            <div>Seller payout: <a id="buyPayout" href="#" target="_blank" rel="noopener">0x…</a></div>
            <div>Max giao hàng: <span id="buyDays">—</span> ngày</div>
          </div>
        </div>

        <div class="form two-col">
          <div>
            <label>Họ tên</label>
            <input id="buyFullname" type="text" placeholder="Nguyễn Văn A" />
          </div>
          <div>
            <label>Số điện thoại</label>
            <input id="buyPhone" type="text" placeholder="09xx..." />
          </div>
          <div class="colspan2">
            <label>Địa chỉ</label>
            <input id="buyAddress" type="text" placeholder="Số nhà, đường, phường/xã, quận/huyện, tỉnh/thành..." />
          </div>
          <div class="colspan2">
            <label>Phụ ghi</label>
            <textarea id="buyNote" rows="2" placeholder="Ghi chú thêm cho người bán (sẽ được mã hóa)"></textarea>
          </div>
          <div>
            <label>Số lượng</label>
            <input id="buyQty" type="number" min="1" step="1" value="1" />
          </div>
          <div class="summary">
            <div>Tổng VIN cần trả (ước tính): <b id="buyTotalVIN">—</b></div>
            <small>VIN/VND lấy từ: Binance (VIC/USDT) × 100 × CoinGecko (USDT→VND). :contentReference[oaicite:3]{index=3}</small>
          </div>
        </div>
      </div>
      <div class="modal-foot">
        <button id="btnPlaceOrder" class="btn primary">Xác nhận mua</button>
        <button id="btnBuyCancel" class="btn">Hủy</button>
      </div>
    </div>
  </div>

  <!-- Update product modal -->
  <div id="modalUpdate" class="modal hidden">
    <div class="modal-card">
      <div class="modal-head">
        <h3>Cập nhật sản phẩm</h3>
        <button class="icon close" id="updClose">×</button>
      </div>
      <div class="modal-body">
        <div class="form">
          <input id="updPid" type="hidden" />
          <label>Giá bán (VND)</label>
          <input id="updPrice" type="number" min="1" step="1" />
          <label>Ví nhận thanh toán</label>
          <input id="updWallet" type="text" placeholder="0x..." />
          <label>Thời gian giao hàng tối đa (ngày)</label>
          <input id="updDays" type="number" min="1" step="1" />
          <label class="checkbox">
            <input id="updActive" type="checkbox" />
            <span>Đang bán (active)</span>
          </label>
        </div>
      </div>
      <div class="modal-foot">
        <button id="btnDoUpdate" class="btn primary">Lưu cập nhật</button>
        <button id="btnUpdCancel" class="btn">Hủy</button>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast" class="toast hidden"></div>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="links">
      <a id="lnkContract" href="#" target="_blank" rel="noopener">Hợp đồng</a>
      <a id="lnkVIN" href="#" target="_blank" rel="noopener">VIN Token</a>
      <a href="https://frollswap.com" target="_blank" rel="noopener">Swap VIN/VIC</a>
      <a href="huongdan.html" target="_blank" rel="noopener">Hướng dẫn</a>
    </div>
    <div class="small">
      On-chain escrow • Người bán nhận tiền khi người mua xác nhận đã nhận hàng; quá hạn buyer có thể hoàn tiền. :contentReference[oaicite:4]{index=4}
    </div>
  </footer>

  <!-- Templates (JS sẽ clone) -->
  <template id="tplProductCard">
    <div class="card product">
      <div class="thumb"><img data-bind="imageCID" alt="" /></div>
      <div class="body">
        <div class="name" data-bind="name">Tên SP</div>
        <div class="price"><span data-bind="priceVND">—</span> VND / <span data-bind="unit">đơn vị</span></div>
        <div class="state">Trạng thái: <span data-bind="activeText">Còn hàng</span></div>
      </div>
      <div class="actions">
        <button class="btn buy" data-action="buy">Mua</button>
        <button class="btn outline update hidden" data-action="update">Cập nhật</button>
      </div>
    </div>
  </template>

  <template id="tplOrderItem">
    <div class="row order">
      <div class="col">
        <div>Mã đơn: <b data-bind="orderId">#</b></div>
        <div>SP: <span data-bind="productName">—</span> (x<span data-bind="quantity">1</span>)</div>
        <div>VIN escrow: <b data-bind="vinAmount">—</b></div>
        <div>Hạn giao: <span data-bind="deadline">—</span></div>
        <div>Trạng thái: <span data-bind="status">—</span></div>
      </div>
      <div class="col actions">
        <button class="btn primary hidden" data-action="confirm">Xác nhận đã nhận hàng</button>
        <button class="btn outline hidden" data-action="refund">Hoàn tiền (quá hạn)</button>
      </div>
    </div>
  </template>

  <!-- App logic -->
  <script src="app.js"></script>
</body>
</html>
